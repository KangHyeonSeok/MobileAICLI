# Phase 1.3: Level 3 기능 테스트 및 검증

> 📌 상위 문서: [COPILOT_INTEGRATION_DESIGN.md](./COPILOT_INTEGRATION_DESIGN.md)
> 📌 선행 작업: [Phase 1.2: 도구 설정 패널 UI](./PHASE_1_2_TOOL_SETTINGS_PANEL.md)

---

## 목표

Phase 1.1 + 1.2 구현 완료 후, Level 3 기능(파일 수정, Git 작업, PR 생성 등)이 정상적으로 동작하는지 종합 테스트 및 검증을 수행한다.

---

## 범위

| 포함 | 제외 |
|------|------|
| Level 1~3 기능 테스트 | 신규 기능 구현 |
| 에러 케이스 검증 | Interactive 모드 (Phase 2) |
| 성능 측정 | |
| 보안 검증 | |
| 문서화 | |

---

## 테스트 시나리오

### Level 1: 질문-응답 (읽기 전용)

| ID | 시나리오 | 예상 결과 |
|----|----------|-----------|
| L1-01 | "이 프로젝트의 구조를 설명해줘" | 프로젝트 분석 후 설명 출력 |
| L1-02 | "CopilotService.cs 파일을 분석해줘" | 파일 읽고 분석 결과 출력 |
| L1-03 | "최근 커밋 5개를 보여줘" | `git log` 결과 출력 |
| L1-04 | 100줄 이상 긴 응답 | 스트리밍으로 점진적 표시 |

### Level 2: 파일 수정

| ID | 시나리오 | 예상 결과 | 필요 권한 |
|----|----------|-----------|-----------|
| L2-01 | "README.md에 설치 방법 섹션 추가해줘" | 파일 수정됨 | FileWrite |
| L2-02 | "새로운 모델 클래스 만들어줘" | 새 파일 생성 | FileWrite |
| L2-03 | "코드 포맷팅 수정해줘" | 파일 수정됨 | FileWrite |
| L2-04 | FileWrite 꺼진 상태에서 수정 요청 | 권한 없음 메시지 | - |

### Level 3: Git 작업

| ID | 시나리오 | 예상 결과 | 필요 권한 |
|----|----------|-----------|-----------|
| L3-01 | "변경사항 커밋해줘" | `git add` + `git commit` 실행 | GitCommit |
| L3-02 | "새 브랜치 만들어서 작업해줘" | `git checkout -b` 실행 | GitBranch |
| L3-03 | "변경사항 푸시해줘" | `git push` 실행 | GitPush |
| L3-04 | GitPush 꺼진 상태에서 푸시 요청 | 권한 없음 또는 승인 요청 | - |

### Level 3: GitHub 작업

| ID | 시나리오 | 예상 결과 | 필요 권한 |
|----|----------|-----------|-----------|
| L3-05 | "열린 PR 목록 보여줘" | PR 목록 출력 | PrRead |
| L3-06 | "이 변경사항으로 PR 만들어줘" | PR 생성됨 | PrWrite |
| L3-07 | "이슈 #123 해결하고 PR 올려줘" | 복합 작업 수행 | 복합 |

---

## 에러 케이스 검증

| ID | 시나리오 | 예상 결과 |
|----|----------|-----------|
| E-01 | Copilot CLI 미설치 상태 | 설치 안내 메시지 |
| E-02 | GitHub 인증 안됨 | 로그인 안내 메시지 |
| E-03 | 타임아웃 (120초 초과) | "시간 초과" 메시지 + 프로세스 종료 |
| E-04 | 네트워크 오류 | SignalR 재연결 시도 |
| E-05 | 동시 세션 초과 (3개 이상) | 대기 또는 거부 메시지 |
| E-06 | 권한 없는 작업 요청 | 도구 설정 패널로 안내 |

---

## 보안 검증

| ID | 시나리오 | 검증 항목 |
|----|----------|-----------|
| S-01 | 프롬프트에 특수문자 포함 | 이스케이프 처리 확인 |
| S-02 | `RepositoryPath` 외부 접근 시도 | 차단 확인 |
| S-03 | 명령 인젝션 시도 (`; rm -rf /`) | 차단 확인 |
| S-04 | deny된 도구 우회 시도 | CLI 옵션 올바르게 적용 |

---

## 성능 측정

| 항목 | 목표 | 측정 방법 |
|------|------|-----------|
| 첫 응답 시작 시간 | 5초 이내 | 프롬프트 전송 → 첫 청크 수신 |
| 전체 응답 시간 | 작업 복잡도에 비례 | 프롬프트 전송 → 완료 신호 |
| 메모리 사용량 | 세션당 100MB 이하 | dotnet-counters 사용 |
| 동시 세션 | 3개 안정 동작 | 병렬 테스트 |

---

## 프리셋별 테스트 매트릭스

| 시나리오 | 안전 | 중간 | 전체 |
|----------|------|------|------|
| 파일 읽기 | ✅ | ✅ | ✅ |
| 파일 쓰기 | ❌ | ✅ | ✅ |
| 파일 삭제 | ❌ | ❌ | ✅ |
| Git 상태 | ✅ | ✅ | ✅ |
| Git 커밋 | ❌ | ✅ | ✅ |
| Git 푸시 | ❌ | ❌ | ✅ |
| PR 조회 | ❌ | ✅ | ✅ |
| PR 생성 | ❌ | ❌ | ✅ |

---

## 테스트 환경 준비

### 필수 환경

```bash
# Node.js v22 이상
node --version

# Copilot CLI 설치
npm install -g @github/copilot

# 인증
copilot  # 첫 실행 시 로그인

# 또는 PAT 사용
export GH_TOKEN=ghp_xxxxx
```

### 테스트용 레포지토리

- 테스트 전용 브랜치 생성: `test/copilot-integration`
- 테스트 후 변경사항 정리

---

## 문서화 작업

테스트 완료 후:

- [ ] 사용자 가이드 작성 (`docs/guides/COPILOT_USER_GUIDE.md`)
- [ ] 트러블슈팅 가이드 작성
- [ ] 설정 옵션 문서화
- [ ] 알려진 제한사항 문서화

---

## 예상 기간

**2일**

| 일차 | 작업 |
|------|------|
| 1일차 | Level 1~3 기능 테스트 + 에러 케이스 검증 |
| 2일차 | 보안 검증 + 성능 측정 + 문서화 |

---

## 완료 기준

- [ ] 모든 테스트 시나리오 통과
- [ ] 에러 케이스 정상 처리 확인
- [ ] 보안 검증 통과
- [ ] 성능 목표 달성
- [ ] 사용자 가이드 작성 완료

---

## 다음 단계

→ [Phase 2: Interactive 모드](./PHASE_2_INTERACTIVE_MODE.md) (필요 시)
